<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://remnux.org/docs/containers/create-docker-images/">
  
  <title>Creating Docker Images for REMnux - REMnux Docs</title>
  

  <link rel="shortcut icon" href="../../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "containers/create-docker-images"
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> REMnux Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Docs Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>REMnux Distro</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../distro/get/">Get the REMnux Distro</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../distro/tools/">Tools Installed on REMnux</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../distro/use/">Using REMnux and Its Tools</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Application Containers</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../malware-analysis/">Docker Images for Malware Analysis</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../run-apps/">Running REMnux-Provided Images</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Creating Docker Images for REMnux</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#documenting-the-build-steps-in-dockerfile">Documenting the Build Steps in Dockerfile</a></li>
                
            
                <li class="toctree-l3"><a href="#building-the-app-image-from-the-dockerfile">Building the App Image from the Dockerfile</a></li>
                
            
                <li class="toctree-l3"><a href="#facilitating-file-system-and-network-interactions">Facilitating File System and Network Interactions</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Expand REMnux</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../expand/contribute/">Contribute Your Expertise</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">REMnux Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Application Containers &raquo;</li>
        
      
    
    <li>Creating Docker Images for REMnux</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Please contribute to the <a href="https://registry.hub.docker.com/repos/remnux/">REMnux&trade; collection of Docker images</a> of malware analysis applications. You&rsquo;ll get a chance to experiment with Docker, become a master at setting up an application of your choice and expand the set of tools that other professionals can conveniently run for examining malicious software.</p>
<p>As a starting point, read the REMnux page regarding <a href="../malware-analysis/">Docker and the notion of containers</a>. Also, familiarize yourself with the approaches to <a href="../run-apps/">running images that have already been created</a> as part of the REMnux project. Next, review the guidelines and examples below. Lastly, read Docker&rsquo;s documentation for <a href="http://docs.docker.com/reference/builder/">building images using a Dockerfile</a>.</p>
<h2 id="documenting-the-build-steps-in-dockerfile">Documenting the Build Steps in Dockerfile</h2>
<p>A properly-formatted Dockerfile describes the steps necessary to build and configure your application inside a Docker container in a repeatable and unattended manner. To get a sense for the structure of such files, browse the <a href="https://github.com/REMnux/docker/">REMnux repository of Dockerfiles on Github</a>. To explain how to build such files, we&rsquo;ll use the <a href="https://github.com/REMnux/docker/blob/master/jsdetox/Dockerfile">JSDetox Dockerfile</a> as an example.</p>
<p>The beginning of your Dockerfile should include comments that state which application is included in the image, who created the app and where it can be obtained in a traditional form. The comments should explain how the use of the image should run it. For instance:</p>
<pre><code># This Docker image encapsulates the JSDetox malware analysis tool by @sven_t
# from http://www.relentless-coding.com/projects/jsdetox
#
# To run this image after installing Docker, use the following command:
# sudo docker run --rm -p 3000:3000 remnux/jsdetox
# Then, connect to http://localhost:3000 using your web browser.
</code></pre>
<p>REMnux images use a minimal Docker image of Ubuntu 14.04 as a starting point, as designated by the <code>FROM</code> directive below. The <code>MAINTAINER</code> tag explains who created and/or maintains the Dockerfile:</p>
<pre><code>FROM ubuntu:14.04
MAINTAINER Lenny Zeltser (@lennyzeltser, www.zeltser.com)
</code></pre>
<p>The <code>RUN</code> directive below tells Docker which commands to run  inside the container when building the image. Your Dockerfile file should include the <code>apt-get update</code> command, followed by <code>apt-get install -y</code> and a listing of the Ubuntu packages that the application requires. Remember that the starting point for the image is a minimal Ubuntu installation, so assume that a given package is not present unless you explicitly install it:</p>
<pre><code>USER root
RUN apt-get update &amp;&amp; apt-get install -y \
  git \
  ruby \
  ruby-dev \
  bundler \
  build-essential &amp;&amp; \
  rm -rf /var/lib/apt/lists/*
</code></pre>
<p>The <code>USER</code> directive above makes sure that Docker will run the <code>apt-get</code> commands as root. Note that the <code>RUN</code> command above links several commands together using <code>&amp;&amp;</code> and employs <code>\</code> to break this sequence of commands into multiple lines for better readability. We&rsquo;re linking several commands in this manner to slightly minimize the size of the resulting Docker image file. This is also the reason why we include the <code>rm</code> command to get rid of the package listing.</p>
<p>The followng <code>RUN</code> directive sets up the non-root user creatively named &ldquo;nonroot&rdquo;, so that commands and applications that don&rsquo;t require root provileges have a more restricted environment within which to run. Note that just as before, we&rsquo;re using <code>&amp;&amp;</code> to string together multiple commands, separating lines with <code>\</code>:</p>
<pre><code>RUN groupadd -r nonroot &amp;&amp; \
  useradd -r -g nonroot -d /home/nonroot -s /sbin/nologin -c "Nonroot User" nonroot &amp;&amp; \
  mkdir /home/nonroot &amp;&amp; \
  chown -R nonroot:nonroot /home/nonroot
</code></pre>
<p>The next set of directives tells Docker to start running commands using the newly-set up &ldquo;nonroot&rdquo; user, defines the working directory to match that user&rsquo;s home directory and retrieves the code for the application we&rsquo;re installing (JSDetox, in this case):</p>
<pre><code>USER nonroot
WORKDIR /home/nonroot
RUN git clone https://github.com/svent/jsdetox.git
</code></pre>
<p>The following instructions will install the application using the <code>bundle install</code> command, according the JSDetox installation instructions. Note that these instructions need to run as root to have the ability to copy the application&rsquo;s files into protected locations:</p>
<pre><code>USER root
WORKDIR /home/nonroot/jsdetox
RUN bundle install
</code></pre>
<p>The final set of directives below tells Docker to switch back to using the &ldquo;nonroot&rdquo; user and sets the working directory to the location from which JSDetox should be launched. It also specifies which command Docker should run when this image is launched without any parameters:</p>
<pre><code>USER nonroot
WORKDIR /home/nonroot/jsdetox
CMD ./jsdetox -l $HOSTNAME 2&gt;/dev/null
</code></pre>
<p>By default, JSDetox listens on &ldquo;localhost&rdquo;. To give us the opportunity to connect to JSDetox from outside of its container, the command above launches the tool with the <code>-l</code> parameter and specifies the $HOSTNAME varilable. This environment variable is automatically defined to match the hostname that Docker will assign when this container runs, which will allow JSDetox to listen on the network interface accessible from our underlying host.</p>
<h2 id="building-the-app-image-from-the-dockerfile">Building the App Image from the Dockerfile</h2>
<p>Your underlying system will need to be connected to the Internet when you build the Docker image, so that it can retrieve the necessary files when installing the application. Also, you&rsquo;ll need to understand what is involved in setting up the app, including knowing its dependencies and configuration nuances.</p>
<p>It&rsquo;s difficult to create a Dockerfile, such as the one we reviewed above, in one shot. Inevitably, some command will run in a manner that you don&rsquo;t expect, preventing the application from installing properly. Before documenting your steps in Dockerfile, consider launching the base ubuntu:14.04 container like this:</p>
<pre><code>sudo docker run --rm -it ubuntu:14.04 bash
</code></pre>
<p>Then, manually type and write down the commands into the container&rsquo;s shell to install the desired application. Once you&rsquo;ve validated that a specific sequence of commands works, start building a Dockerfile by adding your instructions one or two at a time to validate that they work as intended.</p>
<p>Once you&rsquo;ve created a Dockerfile that contains the desired directives, go to the directory where the file is present and run the following command, where &ldquo;image-name&rdquo; is he name you&rsquo;d like to assign to the image file you&rsquo;re building:</p>
<pre><code>sudo docker build -t=image-name .
</code></pre>
<p>Building the image can take some time, depending on the speed of your system and Internet connection, as Docker downloads the necessary packages and, if appropriate, compiles code.</p>
<p><img alt="Building a Docker Image" src="../containers/build-docker-image.png" /></p>
<p>After Docker builds the image, you can run it using the following command to get a shell in the container where your application has been installed:</p>
<pre><code>sudo docker run --rm -it image-name bash
</code></pre>
<p>Of course, &ldquo;image-name&rdquo; in the command above should correspond to the name you&rsquo;ve assigned to the image. The <code>--rm</code> parameter in the command above directs Docker to automatically remove the container once it finishes running. This gets rid of any changes the application may have made to the local environment when it ran, but does not remove the cached image file that represents the app on your system. The <code>-it</code> parameter requests that Docker open an interactive session to the container and assign a pseudo-TTY to it so you can interact with it.</p>
<p>Once you have built and tested your Dockerfile, <a href="https://zeltser.com/contact/">share it with Lenny Zeltser</a>, so he can review it and, if appropriate, incorporate your contribution into the REMnux repository <a href="https://github.com/REMnux/docker">on Github</a> and <a href="https://registry.hub.docker.com/repos/remnux/">on the Docker Hub Registry</a>.</p>
<h2 id="facilitating-file-system-and-network-interactions">Facilitating File System and Network Interactions</h2>
<p>The container will be isolated from the host system: by default it will be able to communicate over the network in the outbound direction, but won&rsquo;t accept inbound traffic. Also, if the container is invoked with the <code>--rm</code> parameter, its contents will  disappear after it stops running. When building the image, you might need to anticipate the user&rsquo;s need to communicate with the app inside the container over the network or to pass files in and out of the container.</p>
<p><strong>Accessing Network Ports in the Container</strong></p>
<p>In the JSDetox example above, the application listens on TCP port 3000. In its default configuration, JSDetox listens on localhost, which would make its port inaccessible from outside its Docker container. This is why we launched JSDetox with the <code>-l $HOSTNAME</code> parameter&ndash;this directed the application to listen on the network interface that could be accessed from outside the container.</p>
<p>Unless the user explicitly requests access to the container&rsquo;s port when launching its image, no ports will be accessible from the underlying system. Fortunately, Docker allows us to use the <code>-p</code> parameter to specify that a specific port within the container should be accessible from outside the container. For example, to access JSDetox&rsquo; port 3000, the user needs to specify <code>-p 3000:3000</code>. This maps the container&rsquo;s port 3000 to the underlying host&rsquo;s port 3000, allowing the user to communicate with JSDetox by connecting to http://localhost:3000 using a web browser.</p>
<p><strong>Sharing Files with the Container</strong></p>
<p>There is no need to share files with JSDetox inside the container by using the file system, because this application interacts with the user through the web browser. In contrast, some files expect the user to provide input or share output via the file system. Docker supports the <code>-v</code> parameter to share a directory between the underlying host and the container.</p>
<p>For example, let&rsquo;s say we wanted to share a folder with the container running the <a href="http://www.rekall-forensic.com/">Rekall Memory Forensic Framework</a>, which is <a href="https://registry.hub.docker.com/u/remnux/rekall/">available from the REMnux Docker repository</a>. If the memory image file that you&rsquo;d like to analyze is located on your underlying host in the ~/files directory, you could share that directory with the Rekall container by specifying <code>-v ~/files:/home/nonroot/files</code> when running the application&rsquo;s image:</p>
<pre><code>sudo docker run --rm -it -v ~/files:/home/nonroot/files remnux/rekall bash
</code></pre>
<p>This maps the local ~/files directory to the /home/nonroot/files directory inside the container. The Rekall image is built to run the user-designated command (e.g., <code>bash</code>) as the user &ldquo;nonroot&rdquo;. To ensure that the non-root user has access to the underlying hosts ~/files directory, the user of the app will need to make that directory world-accessible (i.e., <code>chmod a+xwr ~/files</code>) before launching the container.</p>
<p>The comments in the beginning of your Dockerfile should provide guidelines for how the image should be launched to ensure that the user can provide files and communicate with ports.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../expand/contribute/" class="btn btn-neutral float-right" title="Contribute Your Expertise"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../run-apps/" class="btn btn-neutral" title="Running REMnux-Provided Images"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    
    </p>
  </div>
Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../run-apps/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../expand/contribute/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
